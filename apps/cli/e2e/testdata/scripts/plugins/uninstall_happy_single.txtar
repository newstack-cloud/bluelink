# Test plugins uninstall removes a single plugin
# This test requires the mock-registry container to be running

wait_registry

# Setup auth and plugin path
mkdir $WORK/.bluelink/clients
cp plugins.auth.json $WORK/.bluelink/clients/plugins.auth.json
env HOME=$WORK
env BLUELINK_DEPLOY_ENGINE_PLUGIN_PATH=$WORK/plugins

# First install a plugin
exec bluelink plugins install localhost:18080/bluelink/test-provider@1.0.0
stdout 'installed'

# Verify plugin exists
exists $WORK/plugins/bin/bluelink/test-provider/1.0.0

# Now uninstall it
exec bluelink plugins uninstall localhost:18080/bluelink/test-provider
stdout 'test-provider'
stdout 'removed'
stdout 'Removed: 1'

# Verify plugin directory was removed
! exists $WORK/plugins/bin/bluelink/test-provider/1.0.0

-- bluelink.config.toml --
# Empty config file

-- plugins.auth.json --
{
  "localhost:18080": {
    "apiKey": "test-api-key-12345"
  }
}

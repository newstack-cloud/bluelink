version: 2024-07-20

variables:
  environment:
    type: string
    description: "The deployment environment"
    default: staging

values:
  tableName:
    type: string
    value: "orders-${variables.environment}"
    description: "The DynamoDB table name"

resources:
  ordersTable:
    type: aws/dynamodb/table
    description: "Orders table for storing order data"
    metadata:
      displayName: Orders Table
      labels:
        application: orders
        team: platform
      annotations:
        environment.v1: production
        cost-center.v1: engineering
    linkSelector:
      byLabel:
        application: orders
    spec:
      tableName: orders
      region: us-east-1

  getOrderHandler:
    type: celerity/handler
    description: "Handler for getting order data"
    metadata:
      labels:
        application: orders
    spec:
      handlerName: get-order

datasources:
  network:
    type: aws/vpc
    description: "VPC network configuration"
    filter:
      field: environment
      operator: "="
      search: production
    exports:
      vpcId:
        type: string
        description: "The VPC identifier"
      subnetIds:
        type: array
        description: "List of subnet identifiers"

include:
  auth:
    path: "./auth-blueprint.yaml"
    description: "Authentication child blueprint"

exports:
  tableArn:
    type: string
    field: "resources.ordersTable.state.arn"
    description: "The ARN of the orders table"

metadata:
  annotationRef: "${resources.ordersTable.metadata.annotations['environment.v1']}"
  metadataRef: "${resources.ordersTable.metadata}"
  allAnnotations: "${resources.ordersTable.metadata.annotations}"
  allLabels: "${resources.ordersTable.metadata.labels}"

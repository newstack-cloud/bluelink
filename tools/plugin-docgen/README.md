# plugin json doc generator

[![Coverage](https://sonarcloud.io/api/project_badges/measure?project=newstack-cloud_bluelink-plugin-docgen&metric=coverage)](https://sonarcloud.io/summary/new_code?id=newstack-cloud_bluelink-plugin-docgen)
[![Security Rating](https://sonarcloud.io/api/project_badges/measure?project=newstack-cloud_bluelink-plugin-docgen&metric=security_rating)](https://sonarcloud.io/summary/new_code?id=newstack-cloud_bluelink-plugin-docgen)
[![Maintainability Rating](https://sonarcloud.io/api/project_badges/measure?project=newstack-cloud_bluelink-plugin-docgen&metric=sqale_rating)](https://sonarcloud.io/summary/new_code?id=newstack-cloud_bluelink-plugin-docgen)

The plugin JSON documentation generation tool that generates a JSON document from a plugin that can be used to generate documentation in the Bluelink Registry.

## Installation

```bash
go install github.com/newstack-cloud/bluelink/tools/plugin-docgen/cmd/bluelink-plugin-docgen@latest
```

This will install the `bluelink-plugin-docgen` tool in either the `$GOBIN` directory, which by default will be `$GOPATH/bin`. You'll need to be sure to add this directory to your `PATH` if it is not already included.
You can specify a version by replacing `latest` with the desired version tag.

## Usage

1) You will need to build your plugin and store the plugin in a location that follows the Bluelink plugin directory structure. The plugin directory structure is as follows:
```
├── {plural(pluginType)}
│   ├── {host}? - (only required if the plugin is a part of a private or alternative registry)
│   │   ├── {namespace}
│   │   │   ├── {pluginName}
│   │   │   │    ├── {version}
│   │   │   │    │   ├── plugin
```

For example (a plugin for the official Bluelink registry):
```
├── providers
│   ├── newstack-cloud
│   │   ├── aws
│   │   │    ├── 1.0.0
│   │   │    │   ├── plugin
```

Or a plugin for a private registry:
```
├── providers
│   ├── labs.company.io
│   │   ├── my-namespace
│   │   │    ├── my-plugin
│   │   │    │   ├── 1.0.0
│   │   │    │   ├── plugin
```

2) Get the absolute path of the parent directory of the top-level directory in the plugin directory structure. For example, if the plugin is located at `/path/to/my/plugin/root/providers/newstack-cloud/aws/1.0.0/plugin`, the absolute path would be `/path/to/my/plugin/root`.

3) Set environment variables and run the command:

```bash
# This is a place for the tool to store logs that collect that stdout and stderr output from the plugin.
export BLUELINK_PLUGIN_DOCGEN_PLUGIN_LOG_FILE_ROOT_DIR="/path/for/plugin/logs"
# The absolute path to the directory from step 2.
export BLUELINK_DEPLOY_ENGINE_PLUGIN_PATH="/path/to/my/plugin/root"
bluelink-plugin-docgen -plugin={plugin}
```

Replace `{plugin}` with the unique ID of your plugin. (e.g. `newstack-cloud/aws`)

4) If the tool was successful, it will generate a `docs.json` file in the current working directory. This should then be published as a part of the release workflow so it can be used by a registry (e.g. the official Bluelink Registry) to render HTML documentation.

## Environment Configuration

### Plugin Path

`BLUELINK_DEPLOY_ENGINE_PLUGIN_PATH`

**_required_**

The absolute path to the root directory from which the tool can discover the plugin.
See [Usage](#usage) for more details on preparing the directory structure.

### Log File Root Directory

`BLUELINK_PLUGIN_DOCGEN_PLUGIN_LOG_FILE_ROOT_DIR`

**_required_**

The absolute path to the directory where the tool will store logs that collect the stdout and stderr output from the plugin.

### Plugin Launch Timeout

`BLUELINK_PLUGIN_DOCGEN_PLUGIN_LAUNCH_WAIT_TIMEOUT_MS`

**_optional_**

The amount of time in milliseconds that the tool will wait for plugins to launch before timing out.

**default value:** `10000` (10 seconds)

### Generate Docs Timeout

`BLUELINK_PLUGIN_DOCGEN_GENERATE_TIMEOUT_MS`

**_optional_**

The amount of time in milliseconds that the tool will wait for the plugin to generate the documentation before timing out.

**default value:** `30000` (30 seconds)

### Logging Level

`BLUELINK_PLUGIN_DOCGEN_LOG_LEVEL`

**_optional_**

The logging level for the tool. This can be set to `debug`, `info`, `warn`, or `error`.
This will control the verbosity of the logs that are generated by the tool as a host for the plugin.

**default value:** `info`

## Additional documentation

- [Contributing](docs/CONTRIBUTING.md)

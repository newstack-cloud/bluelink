name: Index Go Library

on:
  push:
    tags:
      # Only trigger for library tags (libs/*)
      - 'libs/*/v*'

jobs:
  index:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/setup-go@v6
        with:
          go-version: '1.24'

      - name: Index module with Go package registry
        run: |
          # Extract module path and version from tag
          # Tag format: libs/blueprint/v0.37.0
          TAG="${GITHUB_REF#refs/tags/}"

          # Extract the library path (e.g., libs/blueprint)
          LIB_PATH="${TAG%/v*}"

          # Extract the version (e.g., v0.37.0)
          VERSION="${TAG##*/}"

          # Build the full module path
          MODULE="github.com/${{ github.repository }}/${LIB_PATH}"

          echo "Indexing module: ${MODULE}@${VERSION}"

          # Prompt Go proxy to index the new version
          GOPROXY=proxy.golang.org go list -m "${MODULE}@${VERSION}"

          echo "Successfully indexed ${MODULE}@${VERSION}"
